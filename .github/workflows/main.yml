name: Save Cogne Webcam Images

on:
  schedule:
    - cron: "*/60 * * * *"   # Ogni 60 minuti
  workflow_dispatch:

permissions:
  contents: write

jobs:
  download:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Scarica immagine webcam Cogne
        run: |
          set -e
          mkdir -p webcam_cogne

          ts=$(date +"%Y-%m-%d_%H-%M")
          img_url="https://www.lovevda.it/Media/LovevdaResp/Cache/Webcam/big_cogne.jpg"
          img_path="webcam_cogne/webcam_${ts}.jpg"

          echo "Scaricando $img_url"
          curl -L -o "$img_path" "$img_url"
          echo "Immagine salvata in $img_path"

      - name: Crea o aggiorna ZIP mensile (max 100MB)
        run: |
          set -e

          MONTH=$(date +"%Y-%m")
          BASE_NAME="cogne_${MONTH}"
          MAX_SIZE=$((95 * 1024 * 1024)) # 95 MB margine sicurezza

          LAST_PART=$(ls ${BASE_NAME}_part*.zip 2>/dev/null | sort | tail -n 1)

          if [ -z "$LAST_PART" ]; then
            PART=1
            ZIP_FILE="${BASE_NAME}_part${PART}.zip"
            echo "C
